<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>

        <script type="text/javascript">


            function geocode() {
                PF('geoMap').geocode(document.getElementById('address').value);
            }
        </script>
    </h:head>
    <h:body>
        <ui:composition  template="../../template/template.xhtml">
            <h:form>
                <p:growl globalOnly="true"/>
                <ui:define name="bodyleft">
                    <div>
                        <h:panelGrid columns="3" style="margin-bottom:10px" cellpadding="5">
                            <p:outputLabel for="address" value="Address:" />
                            <p:inputText id="address" />
                            <p:commandButton value="Geocode" icon="ui-icon-search" onclick="geocode()" type="button" />
                        </h:panelGrid>

                        <p:gmap id="geoGmap" widgetVar="geoMap" center="#{geocodeView.centerGeoMap}" zoom="15" type="HYBRID" model="#{geocodeView.geoModel}" style="width:100%;height:400px">
                            <p:ajax event="geocode" listener="#{geocodeView.onGeocode}" update="@this" />
                        </p:gmap>
                    </div>
                </ui:define>
                <ui:define name="bodycenter">
                    <div>
                        <div>
                            <p:graphicImage value="#{eventoNuevoMB.nuevoEvento.imagen}" id="imgEvento" alt="Imagen para el evento" />
                            <p:commandButton onclick="PF('subirFoto').show()" value="Subir foto evento" icon="ui-icon-pencil"/>
                            <p:dialog widgetVar="subirFoto">
                                <h:outputLabel for='subeFoto' value='#{msg.subeFoto}'>
                                </h:outputLabel>
                                <p:fileUpload id="subeFoto" 
                                              auto="false" mode="simple" 
                                              cancelLabel="#{msg.cancelar}" uploadLabel="#{msg.subir}"
                                              dragDropSupport="true" required="true"
                                              allowTypes="/(\.|\/)(JPG|jpg)$/">
                                </p:fileUpload>
                                <p:commandButton actionListener="#{eventoNuevoMB.subirFotoTemporal()}" ajax="true" value="#{msg.confirmar}" update="imgEvento" oncomplete="if(!args.validationfailed){PF('subirFoto').hide()}"/>
                            </p:dialog>
                        </div>
                        <div>
                            <h:panelGrid columns="2">
                                <h:outputText value="Titulo:"/>
                                <p:inputText value="#{eventoNuevoMB.nuevoEvento.titulo}" maxlength="100" required="true"/>
                                <h:outputText value="Fecha de inicio:"/>
                                <p:calendar value="#{eventoNuevoMB.nuevoEvento.fhinicio}" required="true" pattern="dd/MM/yyyy" 
                                            mindate="#{eventoNuevoMB.hoy}" yearRange="2015:2017"/>
                                <h:outputText value="Hora de inicio:"/>
                                <p:calendar value="#{eventoNuevoMB.nuevoEvento.horainicio}" required="true" pattern="hh:mm" 
                                            timeOnly="true" />
                                <h:outputText value="Descripcion:"/>
                                <p:editor widgetVar="editor" value="#{eventoNuevoMB.nuevoEvento.descripcion}" required="false"/>
                                <h:outputText value="Privaciad:"/>
                                <p:selectOneMenu value="#{eventoNuevoMB.nuevoEvento.privacidad}">
                                    <f:selectItem itemLabel="Público" itemValue="P"/>
                                    <f:selectItem itemLabel="Privado" itemValue="X"/>
                                </p:selectOneMenu>

                                <f:verbatim/>
                                <f:verbatim/>
                                <f:verbatim/>
                                <f:verbatim/>
                                <h:outputText value="¿Guardar?"/>
                                <p:commandButton value="#{msg.confirmar}" action="#{eventoNuevoMB.guardarEvento}" update="@form" />
                                <h:outputText value="¿Cancelar?"/>
                                <p:commandButton value="#{msg.cancelar}" action="#{eventoNuevoMB.irAPerfil}" />
                            </h:panelGrid>





                        </div>
                    </div>
                </ui:define>
                <ui:define name="bodyright">
                    <div>
                        <h:panelGrid columns="1" id="panelAmigos">
                            <h:outputText value="Invitar amigos:"/>
                            <p:commandButton value="Invitar amigos" actionListener="#{eventoNuevoMB.cargarListaAmigos()}" update="panelAmigos"/>
                            <p:panel rendered="#{!eventoNuevoMB.listaAmigo.isEmpty}">
                                <p:selectManyMenu id="advanced" value="#{eventoNuevoMB.listaAmigoId}" 
                                                   filter="true" filterMatchMode="contains" showCheckbox="true">
                                    <f:selectItems value="#{eventoNuevoMB.listaAmigo.keySet().toArray()}" var="amigo" itemLabel="#{eventoNuevoMB.listaAmigo[amigo].nombre} #{eventoNuevoMB.listaAmigo[amigo].apellidop}" itemValue="#{eventoNuevoMB.listaAmigo[amigo].idPersona}"/>

                                    <p:column>
                                        <h:outputText value="#{t.displayName}" />
                                    </p:column>
                                </p:selectManyMenu>
                            </p:panel>
                        </h:panelGrid>
                    </div>

                </ui:define>
            </h:form>
        </ui:composition>
    </h:body>
</html>
